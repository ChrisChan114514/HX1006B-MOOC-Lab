# lab_1_2 - BCD计数器Testbench仿真与硬件验证

## 项目概述

本实验设计了一个功能完整的 4 位十进制计数器（0-9），支持异步复位、使能控制和并行数据加载功能，并通过完整的测试平台验证了设计的正确性。

## Verilog程序设计

### 模块功能

`CNT10` 模块实现了一个可控的十进制计数器，具有以下特性：

- **循环计数**：0-9 循环计数，计数到 9 后自动回到 0
- **异步复位**：低电平异步复位功能，优先级最高
- **使能控制**：通过 EN 信号控制计数器工作状态
- **并行加载**：支持在使能状态下通过 LOAD 信号加载预置数据
- **进位输出**：当计数值为 9 时产生进位信号

### 功能实现机制

计数器的工作遵循以下优先级逻辑：

1. **复位最高优先级**：`RST=0` 时，计数器异步清零（`DOUT=0`）
2. **使能控制**：`EN=1` 时，计数器才能工作
3. **数据加载**：`EN=1` 且 `LOAD=0` 时，加载 `DATA` 到计数器
4. **正常计数**：`EN=1` 且 `LOAD=1` 时，计数器正常递增（0→9→0）
5. **进位输出**：`DOUT=9` 时，`COUT=1`

### 端口说明

| 端口 | 方向   | 位宽 | 说明                        |
| ---- | ------ | ---- | --------------------------- |
| CLK  | input  | 1    | 时钟信号，上升沿触发        |
| RST  | input  | 1    | 异步复位（低电平有效）      |
| EN   | input  | 1    | 使能信号（高电平有效）      |
| LOAD | input  | 1    | 数据加载控制（低电平加载）  |
| DATA | input  | 4    | 并行输入数据（0-9）         |
| DOUT | output | 4    | 计数输出（0-9）             |
| COUT | output | 1    | 进位输出（计数到 9 时为高） |

## ModelSim(Verilog TB代码仿真)

`CNT10_TB.v` 时钟周期为 20ns（频率 50MHz）。

### 测试用例

测试平台包含 10 个测试场景，全面验证计数器功能：

| 测试编号 | 测试内容            | 预期结果                                 |
| -------- | ------------------- | ---------------------------------------- |
| 测试1    | 复位测试            | RST=1 后，DOUT 保持 0                    |
| 测试2    | 正常计数模式（0-9） | EN=1, LOAD=1 时从 0 计数到 9，然后回到 0 |
| 测试3    | EN=0 时禁止加载     | EN=0 时，即使 LOAD=0 也无法加载数据      |
| 测试4    | 从加载值计数        | 从加载的值 5 开始计数到 9                |
| 测试5    | EN=1 时允许加载     | EN=1, LOAD=0 时成功加载数值 8            |
| 测试6    | 进位信号验证        | 从 8 计数到 9 时 COUT=1，然后回到 0      |
| 测试7    | 使能禁止计数        | EN=0 时计数器保持当前值不变              |
| 测试8    | 重新使能计数        | EN 重新置 1 后继续计数                   |
| 测试9    | 运行中复位          | RST=0 时立即清零，RST=1 后恢复计数       |
| 测试10   | 长时间计数          | 验证多个计数周期的稳定性                 |

### 关键观察点

- 复位后 `DOUT` 是否清零
- `EN=0` 时计数器是否保持不变
- `LOAD=0` 时是否正确加载 `DATA`
- 计数到 9 时 `COUT` 是否为 1
- 9→0 的跳变是否正确

## FPGA板子硬件实验

可生成 `.sof` 配置文件，可下载到 FPGA 开发板进行硬件验证。

### 综合结果

- **配置文件**：`output_files/CNT10.sof`
- **下载配置**：`output_files/CNT10.cdf`

### 引脚绑定

#### 输入信号

| 信号    | FPGA引脚 | 硬件元件 | 说明                     |
| ------- | -------- | -------- | ------------------------ |
| CLK     | M1       | KEY1     | 时钟信号（按下为低电平） |
| EN      | E2       | KEY4     | 使能信号（按下为低电平） |
| LOAD    | E1       | KEY3     | 加载信号（按下为低电平） |
| RST     | F3       | KEY2     | 复位信号（按下为低电平） |
| DATA[3] | M2       | SW4      | 数据位3（拨上为高电平）  |
| DATA[2] | M15      | SW3      | 数据位2（拨上为高电平）  |
| DATA[1] | M16      | SW2      | 数据位1（拨上为高电平）  |
| DATA[0] | E16      | SW1      | 数据位0（拨上为高电平）  |

#### 输出信号

| 信号    | FPGA引脚 | 硬件元件 | 说明        |
| ------- | -------- | -------- | ----------- |
| DOUT[3] | T10      | LED1     | 计数输出位3 |
| DOUT[2] | R9       | LED2     | 计数输出位2 |
| DOUT[1] | T9       | LED3     | 计数输出位1 |
| DOUT[0] | K8       | LED4     | 计数输出位0 |

### 硬件测试

1. 使用板载按键作为 RST 和 LOAD 控制信号
2. 使用开关控制 EN 使能信号
3. 使用拨码开关输入 4 位 DATA 数据
4. 通过 LED 显示 DOUT 输出值
5. 使用 LED 指示 COUT 进位信号
6. 建议使用分频后的时钟信号以便观察计数过程

## 文件清单

```
lab_1_2/
├── CNT10.v                    # 十进制计数器模块
├── CNT10_TB.v                 # 测试平台
├── CNT10.qpf                  # Quartus 工程文件
├── CNT10.qsf                  # Quartus 设置文件
├── README.md                  # 本文档
├── 清理Quartus临时文件.bat    # 工程清理脚本
```

ChrisChan
2025/10/25
