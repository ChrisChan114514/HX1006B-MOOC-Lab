# lab_5_2-HDMI音乐播放器工程说明

## 工程概述

本工程是将HX1006A中的VGA图片显示改造为HDMI图片显示，同时保留了乐曲播放器的功能。整合了HDMI显示和音乐播放两大功能模块。

## 改造内容

### 1. 顶层模块

- **文件**: `rtl/hdmi_music_player_top.v`
- **功能**: 整合HDMI显示和音乐播放器功能的顶层模块
- **接口**:
  - 系统输入: `sys_clk`, `sys_rst_n`
  - HDMI输出: `tmds_clk_p/n`, `tmds_data_p/n[2:0]`
  - 音乐输出: `speak` (扬声器), `high` (高音标志), `led[3:0]` (音符显示)

### 2. HDMI显示器的模块

- **video_display.v**:
  - 适配1位黑白ROM数据（从VGAlab）
  - 将1位数据扩展为24位RGB888彩色输出
  - 保留红色边框显示

### 3. 新增音乐播放器模块

复制自VGAlab，位于 `rtl/`目录：

- `speak.v` - 扬声器驱动模块
- `f_code.v` - 音符译码器
- `DFF.v` - D触发器（产生方波）
- `cnt138t.v` - 138计数器（音符序列）
- `fdiv.v` - 分频器（产生4Hz节拍）

### 4. IP核文件

位于 `prj_1006B/ipcore/`目录：

- `pll_clk/` - HDMI像素时钟PLL
- `ddio_out/` - HDMI DDR输出
- `rom_bmp_hdmi.v` - 图片ROM（1位黑白数据，256x256）
- `pll_music.v` - 音乐播放器时钟PLL（1MHz和2KHz）
- `music.v` - 音乐数据ROM

### 5. 数据文件

位于 `prj_1006B/ipcore/`目录：

- `lz256_256.mif` - 256x256黑白图片数据
- `Mif1.mif` - 乐曲数据（138个音符）

## 功能特点

### HDMI显示功能

- 分辨率: 800x600 @ 60Hz
- 图片尺寸: 256x128像素（居中显示）
- 边框: 2像素宽红色边框
- 背景: 黑色
- 图片显示: 1位黑白数据转换为彩色显示

### 音乐播放功能

- 音符数量: 138个
- 节拍速度: 4Hz
- 音调范围: 低音1-7，高音1-7
- LED显示: 4位LED显示当前音符
- 高音指示: high信号指示高音状态

## 时钟架构

### HDMI显示时钟

- **输入**: 50MHz系统时钟
- **PLL输出**:
  - `pixel_clk`: 40MHz（800x600@60Hz像素时钟）
  - `pixel_clk_5x`: 200MHz（HDMI串行化时钟）

### 音乐播放时钟

- **输入**: 50MHz系统时钟
- **PLL输出**:
  - `clk_1M`: 1MHz（扬声器PWM时钟）
  - `clk_2K`: 2KHz（分频器输入）
- **分频输出**:
  - `clk4hz`: 4Hz（音符节拍时钟）

## 测试功能

- **HDMI显示**: 应该看到居中显示的256x128图片，带红色边框
- **音乐播放**: 扬声器应该播放乐曲，LED显示当前音符
