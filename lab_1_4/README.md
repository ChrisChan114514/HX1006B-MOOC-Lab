# lab_1_4 - 带数码管显示的十进制计数器

## 项目概述

本实验设计了一个功能完整的带数码管显示的十进制计数器（0-9），支持异步复位、使能控制和并行数据加载功能，集成了时钟分频和七段数码管译码功能，实现了计数结果的直观显示。

## Verilog程序设计

### 模块功能

`CNT10_DISP` 模块实现了一个带数码管显示的十进制计数器，具有以下特性：

- **循环计数**：0-9 循环计数，计数到 9 后自动回到 0
- **异步复位**：低电平异步复位功能，优先级最高
- **使能控制**：通过 EN 信号控制计数器工作状态
- **并行加载**：支持在使能状态下通过 LOAD 信号加载预置数据
- **进位输出**：当计数值为 9 时产生进位信号，显示在数码管小数点
- **时钟分频**：将 50MHz 时钟分频为 1Hz，便于观察计数过程
- **数码管显示**：集成七段数码管译码器，直接驱动数码管显示计数值

### 功能实现机制

#### 时钟分频模块

- **分频参数**：`DIV_LEN = 50_000_000`，实现 50MHz → 1Hz 的分频
- **分频计数器**：使用 26 位计数器 `div_cnt` 进行分频计数
- **输出时钟**：生成 1Hz 的 `clk` 信号用于计数器

#### 计数器逻辑

计数器的工作遵循以下优先级逻辑：

1. **复位最高优先级**：`reset_n=0` 时，计数器异步清零（`Q1=0`）
2. **使能控制**：`en=1` 时，计数器才能工作
3. **数据加载**：`en=1` 且 `load_n=0` 时，加载 `DATA` (SW) 到计数器
4. **正常计数**：`en=1` 且 `load_n=1` 时，计数器正常递增（0→9→0）
5. **进位输出**：`Q1=9` 时，`cout=1`，显示在数码管的小数点位置

#### 七段数码管译码

- **译码逻辑**：将 4 位二进制计数值译码为 7 段数码管编码
- **显示格式**：共阳极数码管驱动（低电平点亮）
- **支持显示**：0-9 数字及 A-F 十六进制字符（扩展功能）

### 端口说明

| 端口     | 方向   | 位宽 | 说明                                   |
| -------- | ------ | ---- | -------------------------------------- |
| CLK_50   | input  | 1    | 50MHz 系统时钟                         |
| KEY[2:0] | input  | 3    | 按键输入 [en, load_n, reset_n]         |
| SW[3:0]  | input  | 4    | 拨码开关，4 位并行加载数据（0-15）     |
| SEL[7:0] | output | 8    | 数码管位选信号（选择显示哪一位数码管） |
| DIG[7:0] | output | 8    | 数码管段选信号（7 段 + 1 小数点）      |

## ModelSim(Verilog TB代码仿真)

本工程不涉及

## FPGA板子硬件实验

生成 `.sof` 配置文件，下载到 FPGA 开发板进行硬件验证。

### 引脚绑定

#### 输入信号

| 信号   | FPGA引脚 | 硬件元件 | 说明                             |
| ------ | -------- | -------- | -------------------------------- |
| CLK_50 | P11      | 50MHz    | 系统时钟（板载晶振）             |
| KEY[2] | E1       | KEY3     | 使能信号（按下为低电平，需上拉） |
| KEY[1] | F3       | KEY2     | 复位信号（按下为低电平，需上拉） |
| KEY[0] | M1       | KEY1     | 加载信号（按下为低电平，需上拉） |
| SW[3]  | M2       | SW4      | 数据位3（拨上为高电平）          |
| SW[2]  | M15      | SW3      | 数据位2（拨上为高电平）          |
| SW[1]  | M16      | SW2      | 数据位1（拨上为高电平）          |
| SW[0]  | E16      | SW1      | 数据位0（拨上为高电平）          |

#### 输出信号

| 信号   | FPGA引脚 | 硬件元件 | 说明                                 |
| ------ | -------- | -------- | ------------------------------------ |
| SEL[0] | C9       | DIG1_SEL | 数码管位选（第1位，低电平选中）      |
| SEL[1] | D9       | DIG2_SEL | 数码管位选（第2位，低电平选中）      |
| SEL[2] | E11      | DIG3_SEL | 数码管位选（第3位，低电平选中）      |
| SEL[3] | F11      | DIG4_SEL | 数码管位选（第4位，低电平选中）      |
| SEL[4] | C11      | DIG5_SEL | 数码管位选（第5位，低电平选中）      |
| SEL[5] | D11      | DIG6_SEL | 数码管位选（第6位，低电平选中）      |
| SEL[6] | E14      | DIG7_SEL | 数码管位选（第7位，低电平选中）      |
| SEL[7] | F14      | DIG8_SEL | 数码管位选（第8位，低电平选中）      |
| DIG[0] | C14      | SEG_A    | 数码管段选 a（低电平点亮）           |
| DIG[1] | D14      | SEG_B    | 数码管段选 b（低电平点亮）           |
| DIG[2] | E10      | SEG_C    | 数码管段选 c（低电平点亮）           |
| DIG[3] | F10      | SEG_D    | 数码管段选 d（低电平点亮）           |
| DIG[4] | C15      | SEG_E    | 数码管段选 e（低电平点亮）           |
| DIG[5] | D15      | SEG_F    | 数码管段选 f（低电平点亮）           |
| DIG[6] | F9       | SEG_G    | 数码管段选 g（低电平点亮）           |
| DIG[7] | E9       | SEG_DP   | 数码管小数点（低电平点亮，显示进位） |

### 硬件测试步骤

1. **初始化**

   - 按下 KEY2（reset_n），复位计数器
   - 数码管应显示 0
2. **正常计数测试**

   - 松开 KEY2（reset_n=1）
   - 按下 KEY3（en=1）使能计数（需要1s，等待1HZ的clk高电平跳变）
   - 保持 KEY1 松开（load_n=1）
   - 观察数码管每秒递增显示：0→1→2→...→9→0
3. **进位指示测试**

   - 等待计数到 9
   - 观察数码管小数点（DIG[7]）点亮，表示进位信号 cout=1
   - 计数回到 0 时，小数点熄灭
4. **数据加载测试**

   - 通过拨码开关 SW[3:0] 设置加载值（例如：0101 = 5）
   - 按下 KEY1（load_n=0）进行加载
   - 松开 KEY1 后，计数器从加载值开始计数（5→6→7→8→9→0）
5. **使能控制测试**

   - 松开 KEY3（en=0）禁止计数
   - 观察数码管显示保持不变
   - 再次按下 KEY3（en=1），计数继续

ChrisChan
2025/10/27
